<!DOCTYPE html>
<html>
  <head>
    <title>CryptoWorms</title>
    <link
      rel="stylesheet"
      href="css/reset.css"
      type="text/css" />
    <link
      rel="stylesheet"
      href="css/main.css"
      type="text/css" />
    <link
      rel="stylesheet"
      href="css/orientation_utils.css"
      type="text/css" />
    <link
      rel="stylesheet"
      href="css/ios_fullscreen.css"
      type="text/css" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="./favicon.ico" />
    <meta
      http-equiv="Content-Type"
      content="text/html; charset=UTF-8" />

    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,minimal-ui" />
    <meta
      name="msapplication-tap-highlight"
      content="no" />
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  </head>
  <body
    ondragstart="return false;"
    ondrop="return false;">
    <div
      style="
        position: fixed;
        background-color: transparent;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
      "></div>

    <div class="check-fonts">
      <p class="check-font-1">palamecia_titlingregular</p>
    </div>
    <div id="app"></div>
    <!-- <canvas
      id="canvas"
      width="428"
      height="926">
    </canvas> -->
    <!-- <div data-orientation="landscape" class="orientation-msg-container"><p class="orientation-msg-text">Please rotate your device</p></div> -->
    <!-- <div
      id="block_game"
      style="
        position: fixed;
        background-color: transparent;
        top: 0px;
        left: 0px;
        width: 100%;
        height: 100%;
        display: none;
      "></div> -->
    <div
      id="ton-connect"
      style="
        z-index: 999;
        position: absolute;
        top: 7vw;
        margin: auto;
        left: 50%;
        display: none;
        transform: translateX(-50%);
      "></div>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/web-app.js"></script>
    <script>
      const app = window.Telegram.WebApp;
      app.ready();
      app.expand();
    </script>

    <script>
      const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://cryptoworms.online/tonconnect-manifest.json',
        buttonRootId: 'ton-connect',
      });

      tonConnectUI.uiOptions = {
        twaReturnUrl: 'https://cryptoworms.online/',
      };
      async function connectToWallet() {
        if (tonConnectUI.connected) {
          console.log('Already connected to tonConnect UI');

          const connectedData = await tonConnectUI.connector._wallet.account.address;
          fetch('/assignWalletAddress', {
            method: 'POST',
            body: JSON.stringify({
              address: connectedData,
              user_id: app.initDataUnsafe.user.id,
            }),
          });
          return;
        }
        const connectedWallet = await tonConnectUI.connectWallet();

        fetch('/assignWalletAddress', {
          method: 'POST',
          body: JSON.stringify({
            address: connectedWallet.account.address,
            user_id: app.initDataUnsafe.user.id,
          }),
        });
        console.log(connectedWallet);
      }
    </script>

    <script
      type="text/javascript"
      src="js/jquery-3.1.1.min.js"></script>
    <script
      type="text/javascript"
      src="js/createjs.min.js"></script>
    <script
      type="text/javascript"
      src="js/screenfull.js"></script>
    <script
      type="text/javascript"
      src="js/howler.min.js"></script>
    <script
      type="text/javascript"
      src="js/platform.js"></script>
    <script
      type="text/javascript"
      src="js/ios_fullscreen.js"></script>
    <script
      type="text/javascript"
      src="js/ctl_utils.js"></script>
    <script
      type="text/javascript"
      src="js/sprite_lib.js"></script>
    <script
      type="text/javascript"
      src="js/settings.js"></script>
    <script
      type="text/javascript"
      src="js/CLang.js"></script>
    <script
      type="text/javascript"
      src="js/CPreloader.js"></script>
    <script
      type="text/javascript"
      src="js/CMain.js"></script>
    <script
      type="text/javascript"
      src="js/CTextButton.js"></script>
    <script
      type="text/javascript"
      src="js/CToggle.js"></script>
    <script
      type="text/javascript"
      src="js/CGfxButton.js"></script>
    <script
      type="text/javascript"
      src="js/CCreditsPanel.js"></script>
    <script
      type="text/javascript"
      src="js/CMenu.js"></script>
    <script
      type="text/javascript"
      src="js/CGame.js"></script>
    <script
      type="text/javascript"
      src="js/CInterface.js"></script>
    <script
      type="text/javascript"
      src="js/CHelpPanel.js"></script>
    <script
      type="text/javascript"
      src="js/CEndPanel.js"></script>
    <script
      type="text/javascript"
      src="js/CSnake.js"></script>
    <script
      type="text/javascript"
      src="js/CSingleQueue.js"></script>
    <script
      type="text/javascript"
      src="js/CVector2.js"></script>
    <script
      type="text/javascript"
      src="js/CEdges.js"></script>
    <script
      type="text/javascript"
      src="js/CEdge.js"></script>
    <script
      type="text/javascript"
      src="js/CManageFoods.js"></script>
    <script
      type="text/javascript"
      src="js/CFood.js"></script>
    <script
      type="text/javascript"
      src="js/CControlAiSnakes.js"></script>
    <script
      type="text/javascript"
      src="js/CSubAISnake.js"></script>
    <script
      type="text/javascript"
      src="js/CManageSections.js"></script>
    <script
      type="text/javascript"
      src="js/CSection.js"></script>
    <script
      type="text/javascript"
      src="js/CPause.js"></script>
    <script
      type="text/javascript"
      src="js/CAreYouSurePanel.js"></script>
    <script
      type="text/javascript"
      src="js/CBackground.js"></script>
    <script
      type="text/javascript"
      src="js/CAnimMenu.js"></script>
    <script
      type="text/javascript"
      src="js/CLogo.js"></script>
    <script
      type="text/javascript"
      src="js/CAnimHelp.js"></script>

    <script>
      $(document).ready(function () {
        var oMain = new CMain({
          hero_rotation_speed: 10, //HERO ROTATION SPEED WHEN MOVING RIGHT/LEFT
          hero_speed_up: 15, //SET THIS MAX HERO SPEED WHEN PRESS UP KEY
          hero_speed: 10, //MAX HERO SPEED
          snakes_AI_speed: [10, 10, 10, 10],
          food_score: [1], //ADD SCORE WHEN SNAKE EAT A FOOD BY TYPE
          //   fullscreen: true, //SET THIS TO FALSE IF YOU DON'T WANT TO SHOW FULLSCREEN BUTTON
          //   check_orientation: true, //SET TO FALSE IF YOU DON'T WANT TO SHOW ORIENTATION ALERT ON MOBILE DEVICES
        });

        getUserScore();

        $(oMain).on('start_session', function (evt) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeStartSession();
          }
        });

        $(oMain).on('end_session', function (evt) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeEndSession();
          }
        });

        $(oMain).on('start_level', function (evt, iLevel) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeStartLevel({ level: iLevel });
          }
        });

        $(oMain).on('restart_level', function (evt, iLevel) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeRestartLevel({ level: iLevel });
          }
        });

        $(oMain).on('end_level', function (evt, iLevel) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeEndLevel({ level: iLevel });
          }
        });

        $(oMain).on('save_score', function (evt, iScore, szMode) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeSaveScore({ score: iScore, mode: szMode });
          }
        });

        $(oMain).on('show_interlevel_ad', function (evt) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeShowInterlevelAD();
          }
        });

        $(oMain).on('share_event', function (evt, iScore) {
          if (getParamValue('ctl-arcade') === 'true') {
            parent.__ctlArcadeShareEvent({
              img: TEXT_SHARE_IMAGE,
              title: TEXT_SHARE_TITLE,
              msg: TEXT_SHARE_MSG1 + iScore + TEXT_SHARE_MSG2,
              msg_share: TEXT_SHARE_SHARE1 + iScore + TEXT_SHARE_SHARE1,
            });
          }
        });

        if (isIOS()) {
          setTimeout(function () {
            sizeHandler();
          }, 200);
        } else {
          sizeHandler();
        }
      });
    </script>
  </body>
</html>
